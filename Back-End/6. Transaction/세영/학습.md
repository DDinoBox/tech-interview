# Transaction

## 트렌잭션이란?

- 트랜잭션(Transaction)은 데이터베이스의 상태를 변환 시키는 하나의 논리적 기능을 수행하기 위한 작업의 단위 또는 한꺼번에 모두 수행되어야 할 일련의 연산들을 의미한다.

## 큰돌 강의 정리

- 트랜잭션은 데이터베이스에서 하나의 논리적 기능을 수행하기 위한 작업의 단위를 말한다.
- 데이터베이스에 접근하는 방법은 쿼리이므로, 트랜잭션은 여러 개의 쿼리 들을 하나로 묶는 단위 이다.

### **트랜잭션의 특징**

**1.** 트랜잭션은 데이터베이스 시스템에서 병행 제어 및 회복 작업 시 처리되는 작업의 논리적 단위이다.

**2.** 사용자가 시스템에 대한 서비스 요구 시 시스템이 응답하기 위한 상태 변환 과정의 작업단위이다.

**3.** 하나의 트랜잭션은 커밋되거나 롤백된다.

## **트랜잭션의 성질 (ACID)**

### **Atomicity(원자성):** all or nothing

- 트랜잭션의 연산은 데이터베이스에 모두 반영되든지 아니면 전혀 반영되지 않아야 한다.
- 트랜잭션 내의 모든 명령은 반드시 완벽히 수행되어야 하며, 모두가 완벽히 수행되지 않고 어느 하나라도 오류가 발생하면 트랜잭션 전부가 취소되어야 한다.

### **Consistency(일관성)**

- 트랜잭션이 그 실행을 성공적으로 완료하면 언제나 일관성 있는 데이터베이스 상태로 변환한다.
- 시스템이 가지고 있는 고정요소는 트랜잭션 수행 전과 트랜잭션 수행 완료 후의 상태가 같아야 한다.
- 예시: 잔액이 0원인 통장에서 100원을 인출할 수는 없음

### **Isolation(독립성, 격리성)**

- 둘 이상의 트랜잭션이 동시에 병행 실행되는 경우 어느 하나의 트랜잭션 실행 중에 다른 트랜잭션의 연산이 끼어들 수 없다.
- 수행 중인 트랜잭션은 완전히 완료될 때까지 다른 트랜잭션에서 수행 결과를 참조할 수 없다.

### **Durablility(영속성, 지속성)**

- 성공적으로 수행된 트랜잭션은 영원히 반영되어야 한다.
- DB에 장애가 발생해도 원래 상태로 복구하는 회복 기능이 있어야 하며, 이를 위해 체크섬, 저널링, 롤백 등의 기능을 제공한다.

## **트랜잭션 연산 및 상태**

### 커밋 **연산**

- 커밋 연산은 한개의 논리적 단위(트랜잭션)에 대한 작업이 성공적으로 끝났고 데이터베이스가 다시 일관된 상태에 있을 때, 이 트랜잭션이 행한 갱신 연산이 완료된 것을 트랜잭션 관리자에게 알려주는 연산이다.
- 여러 쿼리가 성공적으로 처리되었다고 확정하는 명령어
- 변경된 내용이 모두 영구적으로 저장되는 것

### 롤백 **연산**

- 롤백 연산은 하나의 트랜잭션 처리가 비정상적으로 종료되어 데이터베이스의 일관성을 깨뜨렸을 때, 이 트랜잭션의 일부가 정상적으로 처리되었더라도 트랜잭션의 원자성을 구현하기 위해 이 트랜잭션이 행한 모든 연산을 취소(Undo)하는 연산이다.
- 트랜잭션으로 처리한 하나의 묶음 과정을 일어나기 전으로 돌리는 일(취소)을 말한다.
- 롤백 시에는 해당 트랜잭션을 재시작하거나 폐기한다.

- 커밋과 롤백 덕에 데이터의 무결성이 보장된다.
- 롤백을 고려한다면, 트랜잭션으로 묶는 로직에 외부 API 호출은 자제해야 한다.

### **트랜잭션의 상태**

[https://t1.daumcdn.net/cfile/tistory/999C55345B6D2ED308](https://t1.daumcdn.net/cfile/tistory/999C55345B6D2ED308)

**활동(Active) :** 트랜잭션이 실행중인 상태

**실패(Failed) :** 트랜잭션 실행에 오류가 발생하여 중단된 상태

**철회(Aborted) :** 트랜잭션이 비정상적으로 종료되어 Rollback 연산을 수행한 상태

**부분 완료(Partially Committed) :** 트랜잭션의 마지막 연산까지 실행했지만, Commit 연산이 실행되기 직전의 상태

**완료(Committed) :** 트랜잭션이 성공적으로 종료되어 Commit 연산을 실행한 후의 상태